<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - Doctor Availability</title>
  <style>
    body { font-family: Arial; padding: 30px; background: #f0f0f0; }
    h2 { color: #2c3e50; }
    input, select { margin: 5px; padding: 8px; }
    button { padding: 6px 12px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 25px; background: white; }
    th, td { padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>

<h2>Admin Panel - Doctor Availability</h2>

<h3>Assign Available Time Slot</h3>
<select id="doctorSelect"></select>
<input type="datetime-local" id="timeSlot">
<button id="addBtn">Add Time Slot</button>

<h3>Doctor Time Slots</h3>
<table>
  <thead>
    <tr>
      <th>Doctor</th>
      <th>Available Time</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="slotsTableBody"></tbody>
</table>

<script>
  let editIndex = -1;
  let timeSlots = [];

  async function loadDoctors() {
    const response = await fetch("http://localhost:8080/api/doctors/all");
    const doctors = await response.json();
    const select = document.getElementById('doctorSelect');
    select.innerHTML = '';
    doctors.forEach(doc => {
      const option = document.createElement('option');
      option.value = doc.name;
      option.textContent = `${doc.name} (${doc.specialty})`;
      select.appendChild(option);
    });
  }

  async function loadTimeSlots() {
    const response = await fetch("http://localhost:8080/api/timeslots");
    timeSlots = await response.json();
    renderSlots();
  }

  function renderSlots() {
    const tbody = document.getElementById('slotsTableBody');
    tbody.innerHTML = '';
    timeSlots.forEach((slot, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${slot.doctor}</td>
        <td>${new Date(slot.time).toLocaleString()}</td>
        <td>
          <button onclick="editSlot(${index})">Edit</button>
          <button onclick="deleteSlot(${index})">Delete</button>
        </td>
      `;
      tbody.appendChild(row);
    });
  }

  async function saveTimeSlot() {
    const doctor = document.getElementById('doctorSelect').value;
    const time = document.getElementById('timeSlot').value;

    if (!doctor || !time) return;

    const payload = { doctor, time };
    await fetch("http://localhost:8080/api/timeslots/save", {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    await loadTimeSlots();
    document.getElementById('timeSlot').value = '';
    document.getElementById('addBtn').textContent = 'Add Time Slot';
    editIndex = -1;
  }

  function editSlot(index) {
    const slot = timeSlots[index];
    document.getElementById('doctorSelect').value = slot.doctor;
    document.getElementById('timeSlot').value = slot.time;
    editIndex = index;
    document.getElementById('addBtn').textContent = 'Update Slot';
  }

  async function deleteSlot(index) {
    const slot = timeSlots[index];
    await fetch("http://localhost:8080/api/timeslots/delete", {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(slot)
    });
    await loadTimeSlots();
  }

  document.getElementById('addBtn').addEventListener('click', saveTimeSlot);

  // Load data
  loadDoctors();
  loadTimeSlots();
</script>

</body>
</html>
